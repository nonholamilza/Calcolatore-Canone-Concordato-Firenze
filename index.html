<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Calcolatore Canone Concordato Firenze" />
    <meta name="description" content="Calcola gli affitti a canone concordato per il comune di Firenze. Una calcolatrice gratuita e accessibile per stimare tasse e guadagno netto." />

    <!-- Open Graph / Facebook / WhatsApp -->
      <meta property="og:type" content="website" />
      <meta property="og:url" content="https://nonholamilza.github.io/Calcolatore-Canone-Concordato-Firenze/" />
      <meta property="og:title" content="Calcolatore Canone Concordato Firenze" />
      <meta property="og:description" content="Calcola gli affitti a canone concordato per Firenze. Una calcolatrice gratuita e accessibile per stimare tasse e guadagno netto." />
      <meta property="og:image" content="https://nonholamilza.github.io/Calcolatore-Canone-Concordato-Firenze/anteprima.jpg" />
    
    <!-- Twitter -->
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:url" content="https://nonholamilza.github.io/Calcolatore-Canone-Concordato-Firenze/" />
      <meta name="twitter:title" content="Calcolatore Canone Concordato Firenze" />
      <meta name="twitter:description" content="Scopri gli affitti a canone concordato per Firenze. Una calcolatrice gratuita e accessibile per stimare tasse e guadagno netto." />
      <meta name="twitter:image" content="https://nonholamilza.github.io/Calcolatore-Canone-Concordato-Firenze/anteprima.jpg" />

    <title>Calcolatore Canone Concordato Firenze</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            /*justify-content: center;*/
            font-family: Helvetica, Arial, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #7D1F69 100%);
            min-height: 100vh;
            padding-top: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(240, 240, 240, 1);
            border-radius: 8px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(32px);
            overflow: hidden;
        }

        .header {
            /*background: linear-gradient(135deg, #4facfe 33%, #00f2fe 100%);*/
            color: black;
            padding: 30px 8px 8px 8px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.1em;
            opacity: 1;
        }

        .content {
            max-width: 100%;
            justify-content: center;
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .form-section {
            background: white;
            border-radius: 4px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.10);
            margin-bottom: 20px;
            transition: transform 0.2s ease;
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.20);
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .surface-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            background: #e9ecef;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .results {
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #7D1F69 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .result-card h3 {
            margin-bottom: 20px;
            font-size: 1.4em;
            text-align: center;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .final-result {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            text-align: center;
            padding: 20px;
            border-radius: 16px;
            margin-top: 15px;
        }

        .final-result .price-range {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .validation-message {
            margin-top: 15px;
            padding: 12px 15px;
            border-radius: 6px;
            font-weight: 500;
            text-align: center;
        }

        .validation-message.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .validation-message.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .footer {
            background: #f0F0F0;
            color: #212121;
            padding: 40px 20px 20px 20px;
            margin-top: 60px;
            font-size: 14px;
            line-height: 1.6;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-section {
            margin-bottom: 0px;
        }

        .footer-section h4 {
            color: #212121;
            margin-bottom: px;
            font-size: 16px;
            font-weight: 800;
            border-bottom: 1px solid #212121;
            padding-bottom: 1px;
            display: inline-block;
        }

        .footer-section p {
            margin-bottom: 30px;
            color: #424242;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .organization-list {
            color: #424242;
            font-style: regular;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #424242;
            text-decoration: none;
            padding: 8px 15px;
            border: 1px solid #424242;
            border-radius: 2px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .footer-link:hover {
            background: #424242;
            color: white;
            transform: translateY(-2px);
        }

        .footer-bottom {
            border-top: 1px solid #34495e;
            padding-top: 20px;
            margin-top: 10px;
            text-align: center;
            color: #7f8c8d;
            font-size: 12px;
        }

        .license-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .surface-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .container {
                margin: 10px;
            }

            .footer {
                padding: 30px 15px 15px 15px;
            }
            
            .footer-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .footer-links {
                flex-direction: column;
                align-items: stretch;
            }
            
            .footer-link {
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                margin: 15px;
                border-radius: 8px;
            }
        
            .header {
                padding: 20px 30px;
            }
        
            .header h1 {
                font-size: 1.6em;
            }
        
            .header p {
                font-size: 0.95em;
            }
        
            .content {
                padding: 20px 10px;
                gap: 20px;
            }
        
            .form-section {
                padding: 15px;
            }
        
            .form-section h3 {
                font-size: 1.1em;
            }
        
            .form-group label {
                font-size: 0.95em;
            }
        
            .form-group input,
            .form-group select {
                font-size: 0.95em;
                padding: 10px;
            }
        
            .result-card {
                padding: 15px;
            }
        
            .final-result .price-range {
                font-size: 1.6em;
            }
        
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        .btn-calculate {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s ease;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏠 Calcolatore Canone Concordato</h1>
            <p>⚜️ Comune di Firenze - Calcolo automatico del canone di locazione</p>
        </div>

        <div class="content">
            <div class="form-container">
                <!-- Sezione Quartiere -->
                <div class="form-section">
                    <h3>📍 Ubicazione</h3>
                    <div class="form-group">
                        <label for="quartiere">Quartiere:</label>
                        <select id="quartiere">
                            <option value="">Seleziona quartiere</option>
                            <option value="centro">Centro Storico, Lungarno, Piazza Ferrucci</option>
                            <option value="bobolino">Bobolino, Due Strade, Marignolle, La Pietra, Careggi, Settignano</option>
                            <option value="poggetto">Poggetto, Cure, Campo di Marte, Madonnone/Bellariva, Bandino, Nave a Rovezzano, Novoli, Coverciano, Varlungo</option>
                            <option value="sanjacopino">San Jacopino, Dalmazia, Cascine del Riccio, Galluzzo</option>
                            <option value="legnaia">Legnaia, Isolotto, Argingrosso, Castello</option>
                            <option value="piagge">Piagge, Peretola, Mantignano, Cupolina</option>
                        </select>
                    </div>
                </div>

                <!-- Sezione Superficie -->
                <div class="form-section">
                    <h3>📐 Calcolo Superficie Convenzionale</h3>
                    <div class="surface-grid">
                        <div class="form-group">
                            <label for="surfaceA">Superficie interna utile abitativa (mq):</label>
                            <input type="number" id="surfaceA" step="0.1" min="0">
                            <div class="info-text"><em>A</em> - 100% - Area effettivamente calpestabile (h≥240cm)</div>
                        </div>
                        <div class="form-group">
                            <label for="surfaceA1">Superficie bassa (mq):</label>
                            <input type="number" id="surfaceA1" step="0.1" min="0">
                            <div class="info-text"><em>A1</em> - 30% - Aree interne, sottotetto di altezza tra 180-240cm</div>
                        </div>
                        <div class="form-group">
                            <label for="surfaceB">Autorimesse/box/depositi (mq):</label>
                            <input type="number" id="surfaceB" step="0.1" min="0">
                            <div class="info-text"><em>B</em> - 50% - Superficie utile autorimesse singole</div>
                        </div>
                        <div class="form-group">
                            <label for="surfaceH">Balconi, terrazze, cantine (mq):</label>
                            <input type="number" id="surfaceH" step="0.1" min="0">
                            <div class="info-text"><em>H</em> - 25% - Superficie utile pertinenze</div>
                        </div>
                        <div class="form-group">
                            <label for="surfaceC">Lastrici solari attico (mq):</label>
                            <input type="number" id="surfaceC" step="0.1" min="0">
                            <div class="info-text"><em>C</em> - 25% - Uso esclusivo piano attico</div>
                        </div>
                        <div class="form-group">
                            <label for="surfaceI">Superficie scoperta esclusiva (mq):</label>
                            <input type="number" id="surfaceI" step="0.1" min="0">
                            <div class="info-text"><em>I</em> - 10% - Corti, giardini in godimento esclusivo</div>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; color: #666;">🚗 Posti Auto</h4>
                    <div class="parking-section">
                        <div class="surface-grid">
                            <div class="form-group">
                                <label for="parkingD">Posti auto esclusivi (n°):</label>
                                <input type="number" id="parkingD" step="1" min="0" onchange="updateParkingSurface('D')">
                                <div class="info-text"><em>D</em> - 30% - Coperti/scoperti in area esclusiva (15mq/posto)</div>
                            </div>
                            <div class="form-group">
                                <label for="parkingE">Posti auto comuni coperti (n°):</label>
                                <input type="number" id="parkingE" step="1" min="0" onchange="updateParkingSurface('E')">
                                <div class="info-text"><em>E</em> - 25% - Autorimesse comuni assegnate (15mq/posto)</div>
                            </div>
                            <div class="form-group">
                                <label for="parkingF">Posti auto comuni scoperti (n°):</label>
                                <input type="number" id="parkingF" step="1" min="0" onchange="updateParkingSurface('F')">
                                <div class="info-text"><em>F</em> - 20% - Spazi comuni assegnati (15mq/posto)</div>
                            </div>
                            <div class="form-group">
                                <label for="parkingG">Posti auto turnari (n°):</label>
                                <input type="number" id="parkingG" step="1" min="0" onchange="updateParkingSurface('G')">
                                <div class="info-text"><em>G</em> - 5% - Rotazione turnaria (15mq/posto)</div>
                            </div>
                        </div>
                        
                        <!-- Campi nascosti per i calcoli -->
                        <input type="hidden" id="surfaceD" value="0">
                        <input type="hidden" id="surfaceE" value="0">
                        <input type="hidden" id="surfaceF" value="0">
                        <input type="hidden" id="surfaceG" value="0">
                    </div>
                </div>

                <!-- Sezione Tipologia -->
                <div class="form-section">
                    <h3>🏗️ Tipologia Alloggio</h3>
                    <div class="form-group">
                        <label for="tipologia">Tipologia:</label>
                        <select id="tipologia">
                            <option value="">Seleziona tipologia</option>
                            <option value="A">Tipologia A - Immobili di recente costruzione o ristrutturazione</option>
                            <option value="B">Tipologia B - Immobili con buone caratteristiche</option>
                            <option value="C">Tipologia C - Immobili con caratteristiche conformi alla normativa vigente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Caratteristiche per rientrare nella Tipologia A: <span id="counter">0</span> / 6:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doppiservizi">
                                <label for="doppiservizi">Doppio bagno</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ascensore">
                                <label for="ascensore">Ascensore (per abitazioni oltre al terzo piano)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fibra">
                                <label for="fibra">Copertura fibra ottica FTTH </label> <a href="https://fibermap.it/" target="_blank" style="color: #4facfe;">🔗</a>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="verdi">
                                <label for="verdi">Spazi verdi condominiali</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="condizionamento">
                                <label for="condizionamento">Aria Condizionata</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="parcheggio">
                                <label for="parcheggio">Parcheggio condominale assegnato</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="spaziesterni">
                                <label for="spaziesterni">Giardino/Spazi esterni esclusivi</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="allarme">
                                <label for="allarme">Sistema di allarme e/o inferriate</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="portierato">
                                <label for="portierato">Portierato o Videosorveglianza</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="blindato">
                                <label for="blindato">Portone blindato</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="rifiniture">
                                <label for="rifiniture">Finiture pregiate (materiali pregiati, affreschi, arredi di design)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fotovoltaico">
                                <label for="fotovoltaico">Impianto Fotovoltaico/Solare</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sezione Maggiorazioni -->
                <div class="form-section">
                    <h3>⬆️ Maggiorazioni</h3>
                    <div class="form-group">
                        <label for="arredo">Arredo:</label>
                        <select id="arredo">
                            <option value="0">Non arredato</option>
                            <option value="7">Arredato per 1/3 dei vani (+7%)</option>
                            <option value="10">Arredato per 2/3 dei vani (+10%)</option>
                            <option value="15">Completamente arredato (+15%)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pregio">Immobile di particolare pregio:</label>
                        <select id="pregio">
                            <option value="0">No</option>
                            <option value="10">A/7 - Villini (+10%)</option>
                            <option value="15">Particolare pregio (+15%)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="energia">Classe energetica:</label>
                        <select id="energia">
                            <option value="0">Classe F/G (nessun incremento)</option>
                            <option value="2">Classe E (+2%)</option>
                            <option value="4">Classe D (+4%)</option>
                            <option value="6">Classe C (+6%)</option>
                            <option value="8">Classe B (+8%)</option>
                            <option value="10">Classe A1 (+10%)</option>
                            <option value="12">Classe A2 (+12%)</option>
                            <option value="14">Classe A3 (+14%)</option>
                            <option value="15">Classe A4 (+15%)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="durata">Tipologia contratto:</label>
                        <select id="durata">
                            <option value="0">Contratto 3+2 standard</option>
                            <option value="4.5">Contratto 4+2 (+4,5%)</option>
                            <option value="6">Contratto 5+2 (+6%)</option>
                            <option value="7.5">Contratto 6+ anni (+7,5%)</option>
                            <option value="15">Contratto studenti (+15%)</option>
                            <option value="5">Contratto transitorio (+5%)</option>
                        </select>
                    </div>
                </div>

                <!-- Sezione Tasse -->
                <div class="form-section">
                    <h3>💰 Calcolo Tasse e Confronto</h3>
                    <div class="form-group">
                        <label for="valoreCatastale">Valore catastale dell'immobile (€):</label>
                        <input type="number" id="valoreCatastale" step="100" min="0" placeholder="Es. 150000">
                        <div class="info-text">Se non disponibile, verrà calcolato automaticamente una stima</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="scontoCanone">Applichi uno sconto di almeno 10% sul canone massimo?</label>
                        <select id="scontoCanone">
                            <option value="no">No</option>
                            <option value="si">Sì (IMU ridotta allo 0,46%)</option>
                        </select>
                        <div class="info-text">Lo sconto riduce ulteriormente l'IMU per il canone concordato</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confrontoCanone">Confronta con canone libero:</label>
                        <select id="confrontoCanone">
                            <option value="10">Canone concordato +10%</option>
                            <option value="20">Canone concordato +20%</option>
                            <option value="50">Canone concordato +50%</option>
                            <option value="custom">Inserisci canone personalizzato</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="customRentGroup" style="display: none;">
                        <label for="customRent">Canone libero mensile (€):</label>
                        <input type="number" id="customRent" step="10" min="0" placeholder="Es. 1200">
                        <div class="info-text">Inserisci il canone mensile del mercato libero per il confronto</div>
                    </div>
                </div>

                <button class="btn-calculate" onclick="calculateRent()">🧮 Calcola Canone e Tasse</button>
            </div>

            <div class="results">
                <div class="result-card">
                    <h3>📊 Risultati Calcolo</h3>
                    <div id="results-content">
                        <p style="text-align: center; color: rgba(255,255,255,0.7); font-style: italic;">
                            Compila i campi e clicca "Calcola Canone" per vedere i risultati
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>📋 Riferimenti Normativi</h4>
                <p>Calcoli sui parametri stabiliti dall'<a target="_blank" rel="noopener noreferrer" href="https://sociale.comune.fi.it/system/files/2025-07/Accorro%20territoriale%20Firenze%20e%20comuni%20limitrofi%20sottoscritto%20il%2003.07.2025%20e%20valido%20dal%2007.07.2025_250704_105950.pdf">Accordo Territoriale sulle locazioni abitative</a> del 03/07/2025 e dalle <a target="_blank" rel="noopener noreferrer" href="https://www.comune.firenze.it/novita/notizie/nuovi-accordi-territoriali-sulle-locazioni-abitative">agevolazioni IMU</a> del comune di Firenze.</p>
            </div>

            <div class="footer-grid">
                <div class="footer-section">
                    <h4>🏠 Organizzazioni Sindacali Inquilini</h4>
                    <p class="organization-list">
                        <a target="_blank" rel="noopener noreferrer" href="https://www.sunia.it/">SUNIA</a> • <a target="_blank" rel="noopener noreferrer" href="https://www.sicet.it/">SICET</a> • <a target="_blank" rel="noopener noreferrer" href="https://uiltoscana.it/uniat/">UNIAT</a> • <a target="_blank" rel="noopener noreferrer" href="https://www.unioneinquilini.it/?sedi=firenze">UNIONE INQUILINI</a> • <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/search?q=CONIA+%E2%80%93+FENAPI+Firenze%2C+via+Sant%27Angelo+17%2C+Firenze&oq=CONIA+%E2%80%93+FENAPI+Firenze%2C+via+Sant%27Angelo+17%2C+Firenze&gs_lcrp=EgZjaHJvbWUyBggAEEUYOTIGCAEQLhhA0gEHMjQ1ajBqOagCALACAQ&sourceid=chrome&ie=UTF-8">CONIA</a>
                    </p>
                </div>

                <div class="footer-section">
                    <h4>🏢 Associazioni Proprietari Immobiliari</h4>
                    <p class="organization-list">
                        <a target="_blank" rel="noopener noreferrer" href="http://www.appcfirenze.it/web/">APPC</a> • <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/search?q=ASPPI+Firenze">ASPPI</a> • <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/search?q=CONFABITARE+firenze">CONFABITARE</a> • <a target="_blank" rel="noopener noreferrer" href="https://sociale.comune.fi.it/system/files/2025-02/Adesione%20Firenze.pdf">CONFAPPI</a> • <a target="_blank" rel="noopener noreferrer" href="https://www.confediliziafirenze.it/">CONFEDILIZIA</a> • <a target="_blank" rel="noopener noreferrer" href="http://www.uppifirenze.it/">UPPI Area Metropolitana Fiorentina</a> • <a target="_blank" rel="noopener noreferrer" href="https://uppi.it/sede/">UPPI Delegazioni Provinciali</a>
                    </p>
                </div>
            </div>

            <div class="footer-section">
                <h4>⚖️ Informazioni Legali e Sviluppo</h4>
                <p>
                    Sviluppato da <strong>nonholamilza</strong> grazie a <strong>Claude LLM</strong>. 
                    Nessun dato o informazione sull'individuo viene raccolto, nessun dato viene utilizzato a fini commerciali.
                    <span class="license-badge">GNU v3.0</span>
                </p>
                
                <div class="footer-links">
                    <a href="https://github.com/nonholamilza/canone-concordato-firenze" target="_blank" class="footer-link">
                        🔗 Repository Github
                    </a>
                    <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank" class="footer-link">
                        📄 Licenza GNU v3.0
                    </a>
                </div>
            </div>

            <div class="footer-bottom">
                <p>2025 Calcolatore Canone Concordato Firenze • Strumento gratuito e open source per proprietari e inquilini</p>
                <p>⚠️ Questo strumento ha scopo informativo. Per consulenze legali consultare sempre un professionista qualificato.</p>
            </div>
        </div>
    </footer>

    <script>
        // Coefficienti di zonizzazione
        const zoningCoefficients = {
            centro: { A: [11.00, 13.00], B: [7.00, 11.00], C: [2.00, 7.00] },
            bobolino: { A: [12.00, 13.50], B: [7.50, 12.00], C: [2.00, 7.50] },
            poggetto: { A: [9.00, 10.20], B: [5.50, 9.00], C: [2.00, 5.50] },
            sanjacopino: { A: [8.70, 9.70], B: [5.50, 8.70], C: [2.00, 5.50] },
            legnaia: { A: [8.20, 9.20], B: [5.50, 8.20], C: [2.00, 5.50] },
            piagge: { A: [8.10, 8.75], B: [5.00, 8.10], C: [2.00, 5.00] }
        };

        function calculateConventionalSurface() {
            const surfaceA = parseFloat(document.getElementById('surfaceA').value) || 0;
            const surfaceA1 = (parseFloat(document.getElementById('surfaceA1').value) || 0) * 0.3;
            const surfaceB = (parseFloat(document.getElementById('surfaceB').value) || 0) * 0.5;
            const surfaceC = (parseFloat(document.getElementById('surfaceC').value) || 0) * 0.25;
            const surfaceD = (parseFloat(document.getElementById('surfaceD').value) || 0) * 0.3;
            const surfaceE = (parseFloat(document.getElementById('surfaceE').value) || 0) * 0.25;
            const surfaceF = (parseFloat(document.getElementById('surfaceF').value) || 0) * 0.2;
            const surfaceG = (parseFloat(document.getElementById('surfaceG').value) || 0) * 0.05;
            const surfaceH = (parseFloat(document.getElementById('surfaceH').value) || 0) * 0.25;
            
            const surfaceIRaw = parseFloat(document.getElementById('surfaceI').value) || 0;
            const surfaceIBase = Math.min(surfaceIRaw, surfaceA) * 0.1;
            const surfaceIExtra = Math.max(0, surfaceIRaw - surfaceA) * 0.02;
            const surfaceI = surfaceIBase + surfaceIExtra;

            const additionalSurfaces = surfaceA1 + surfaceB + surfaceC + surfaceD + surfaceE + surfaceF + surfaceG + surfaceH + surfaceI;
            
            let totalSurface = surfaceA + additionalSurfaces;
            let warning = '';

            // Applicazione tetti massimi
            if (surfaceA < 60) {
                const maxAdditional = surfaceA * 0.2;
                const maxTotal = Math.min(63, surfaceA + maxAdditional);
                if (totalSurface > maxTotal) {
                    totalSurface = maxTotal;
                    warning = 'Superficie limitata dal tetto massimo (20% per A<60mq)';
                }
            } else if (surfaceA <= 65) {
                const maxAdditional = surfaceA * 0.05;
                const maxTotal = Math.min(65, surfaceA + maxAdditional);
                if (totalSurface > maxTotal) {
                    totalSurface = maxTotal;
                    warning = 'Superficie limitata dal tetto massimo (5% per A>60mq)';
                }
            }

            return { totalSurface, warning };
        }

        function calculateRent() {
            const quartiere = document.getElementById('quartiere').value;
            const tipologia = document.getElementById('tipologia').value;
            
            if (!quartiere || !tipologia) {
                alert('Seleziona quartiere e tipologia alloggio');
                return;
            }

            const { totalSurface, warning } = calculateConventionalSurface();
            
            if (totalSurface === 0) {
                alert('Inserisci almeno la superficie interna abitativa');
                return;
            }

            // Coefficienti base
            const coefficients = zoningCoefficients[quartiere][tipologia];
            const baseMinRent = totalSurface * coefficients[0];
            const baseMaxRent = totalSurface * coefficients[1];

            // Maggiorazioni
            const arredo = parseFloat(document.getElementById('arredo').value) || 0;
            const pregio = parseFloat(document.getElementById('pregio').value) || 0;
            const energia = parseFloat(document.getElementById('energia').value) || 0;
            const durata = parseFloat(document.getElementById('durata').value) || 0;

            const totalMaggiorazioni = arredo + pregio + energia + durata;

            // Calcolo finale
            let finalMinRent = baseMinRent * (1 + totalMaggiorazioni / 100);
            let finalMaxRent = baseMaxRent * (1 + totalMaggiorazioni / 100);

            // Applicazione sconto del 10% se selezionato
            const scontoCanone = document.getElementById('scontoCanone').value;
            let finalMaxRentForTax = finalMaxRent; // Valore per calcolo tasse
            let scontoApplicato = false;

            if (scontoCanone === 'si') {
                finalMaxRentForTax = finalMaxRent * 0.90; // Sconto 10% per calcoli IMU
                finalMaxRent = finalMaxRentForTax; // Mostra il valore scontato anche nei risultati
                scontoApplicato = true;
            }

            // Conteggio caratteristiche Tipologia A
            let caratteristicheA = 0;
            if (tipologia === 'A') {
                const checkboxes = ['condizionamento', 'rifiniture', 'doppiservizi', 'parcheggio', 'spaziesterni', 'allarme', 'portierato', 'fibra', 'blindato', 'ascensore', 'verdi', 'fotovoltaico'];
                caratteristicheA = checkboxes.filter(id => document.getElementById(id).checked).length;
            }

            // Calcolo tasse
            let taxData = null;
            let valoreCatastale = parseFloat(document.getElementById('valoreCatastale').value);
            const confrontoCanone = document.getElementById('confrontoCanone').value;
            
            // Se non è inserito il valore catastale, lo stimiamo
            if (!valoreCatastale) {
                const surfaceA = parseFloat(document.getElementById('surfaceA').value) || 0;
                valoreCatastale = estimateValoreCatastale(surfaceA, quartiere, tipologia);
            }
            
            if (valoreCatastale > 0) {
                // Canone concordato annuale (usando il valore con sconto se applicato)
                const canoneAnnualeConcordato = finalMaxRentForTax * 12;
                
                // Calcolo canone libero annuale
                let canoneAnnualeLibero;
                if (confrontoCanone === 'custom') {
                    const customRent = parseFloat(document.getElementById('customRent').value);
                    if (customRent > 0) {
                        canoneAnnualeLibero = customRent * 12;
                    } else {
                        canoneAnnualeLibero = canoneAnnualeConcordato * 1.1; // Default +10%
                    }
                } else {
                    const percentuale = parseFloat(confrontoCanone) / 100;
                    canoneAnnualeLibero = canoneAnnualeConcordato * (1 + percentuale);
                }
                
                taxData = calculateTaxes(canoneAnnualeConcordato, canoneAnnualeLibero, valoreCatastale, scontoCanone);
                taxData.canoneAnnualeConcordato = canoneAnnualeConcordato;
                taxData.canoneAnnualeLibero = canoneAnnualeLibero;
            }

            // Mostra risultati
            displayResults({
                totalSurface,
                warning,
                baseMinRent,
                baseMaxRent,
                totalMaggiorazioni,
                finalMinRent,
                finalMaxRent,
                caratteristicheA,
                tipologia,
                taxData,
                valoreCatastale,
                canoneAnnuale: taxData ? taxData.canoneAnnualeConcordato : 0,
                scontoApplicato
            });
        }

        function calculateTaxes(canoneAnnualeConcordato, canoneAnnualeLibero, valoreCatastale, scontoCanone) {
            // Cedolare secca
            const cedolareConcordato = canoneAnnualeConcordato * 0.10; // 10%
            const cedolareLibero = canoneAnnualeLibero * 0.21; // 21%
            
            // IMU
            let imuConcordato;
            if (scontoCanone === 'si') {
                imuConcordato = valoreCatastale * 0.0046; // 0,46%
            } else {
                imuConcordato = valoreCatastale * 0.0057; // 0,57%
            }
            const imuLibero = valoreCatastale * 0.0106; // 1,06%
            
            // Guadagno netto
            const nettoConcordato = canoneAnnualeConcordato - cedolareConcordato - imuConcordato;
            const nettoLibero = canoneAnnualeLibero - cedolareLibero - imuLibero;
            
            // Totale tasse
            const tasseConcordato = cedolareConcordato + imuConcordato;
            const tasseLibero = cedolareLibero + imuLibero;
            
            // Percentuale di incremento tasse
            const incrementoTasse = ((tasseLibero - tasseConcordato) / tasseConcordato) * 100;
            
            // Calcolo percentuale di incremento del canone
            const incrementoCanone = ((canoneAnnualeLibero - canoneAnnualeConcordato) / canoneAnnualeConcordato) * 100;
            
            return {
                cedolareConcordato,
                cedolareLibero,
                imuConcordato,
                imuLibero,
                nettoConcordato,
                nettoLibero,
                tasseConcordato,
                tasseLibero,
                incrementoTasse,
                incrementoCanone
            };
        }

        // Aggiorna superficie parcheggi basata sul numero di posti
        function updateParkingSurface(type) {
            const numPosti = parseFloat(document.getElementById(`parking${type}`).value) || 0;
            const superficie = numPosti * 15; // 15 mq per posto
            document.getElementById(`surface${type}`).value = superficie;
            
            // Ricalcola se ci sono già dati
            if (document.getElementById('quartiere').value && document.getElementById('tipologia').value) {
                setTimeout(calculateRent, 100);
            }
        }

        function estimateValoreCatastale(superficie, quartiere, tipologia) {
            // Stima basata sui valori medi €/mq per zona
            const valoriMediMq = {
                centro: { A: 4500, B: 3800, C: 3200 },
                bobolino: { A: 4200, B: 3500, C: 2900 },
                poggetto: { A: 3500, B: 2900, C: 2400 },
                sanjacopino: { A: 3200, B: 2700, C: 2200 },
                legnaia: { A: 3000, B: 2500, C: 2000 },
                piagge: { A: 2800, B: 2300, C: 1900 }
            };
            
            const valoreMedio = valoriMediMq[quartiere][tipologia];
            // Il valore catastale è calcolato con il 65% del valore di mercato
            return superficie * valoreMedio * 0.65;
        }

        // Elementi DOM per arrivare a 6 elementi classe A
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const counter = document.getElementById('counter');
        const counterDisplay = document.getElementById('counterDisplay');
        const progressFill = document.getElementById('progressFill');
        const validationMessage = document.getElementById('validationMessage');
        const checkboxItems = document.querySelectorAll('.checkbox-item');

        // Funzione per aggiornare il conteggio
        function updateCounter() {
            const checkedCount = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const totalCount = checkboxes.length;
            
            // Aggiorna il contatore
            counter.textContent = checkedCount;
            
            // Aggiorna la barra di progresso
            if (progressFill) {
                const progressPercentage = (checkedCount / totalCount) * 100;
                progressFill.style.width = progressPercentage + '%';
            }
            
            // Cambia stile del display in base al raggiungimento dell'obiettivo
            if (counterDisplay) {
                if (checkedCount >= 6) {
                    counterDisplay.classList.add('success');
                    showValidationMessage('✅ Requisiti soddisfatti! L\'immobile rientra nella Tipologia A', 'success');
                } else {
                    counterDisplay.classList.remove('success');
                    const remaining = 6 - checkedCount;
                    showValidationMessage(`⚠️ Mancano ancora ${remaining} caratteristiche per raggiungere la Tipologia A`, 'warning');
                }
            }
        }

        // Funzione per mostrare messaggi di validazione
        function showValidationMessage(message, type) {
            if (validationMessage) {
                validationMessage.textContent = message;
                validationMessage.className = `validation-message ${type}`;
                validationMessage.style.display = 'block';
            }
        }

        // Aggiunge event listener per ogni checkbox
        checkboxes.forEach((checkbox, index) => {
            checkbox.addEventListener('change', function() {
                const checkboxItem = checkboxItems[index];
                
                // Aggiunge/rimuove classe per lo stile
                if (this.checked) {
                    checkboxItem.classList.add('checked');
                } else {
                    checkboxItem.classList.remove('checked');
                }
                
                // Aggiorna il conteggio
                updateCounter();
            });
        });

        // Event listener per rendere clickabile tutto il div checkbox-item
        checkboxItems.forEach((item, index) => {
            item.addEventListener('click', function(e) {
                // Evita il doppio click se si clicca direttamente sulla checkbox
                if (e.target.type !== 'checkbox' && e.target.tagName !== 'LABEL' && e.target.tagName !== 'A') {
                    const checkbox = checkboxes[index];
                    checkbox.checked = !checkbox.checked;
                    
                    // Trigger dell'evento change
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
        });

        // Inizializza il contatore
        updateCounter();

        // Funzione per ottenere i risultati (utile per integrazioni future)
        function getSelectedFeatures() {
            const selected = [];
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const label = document.querySelector(`label[for="${checkbox.id}"]`).textContent;
                    selected.push({
                        id: checkbox.id,
                        label: label
                    });
                }
            });
            return selected;
        }

        // Funzione per verificare se soddisfa i requisiti
        function meetsRequirements() {
            return document.querySelectorAll('input[type="checkbox"]:checked').length >= 6;
        }

        // Rende le funzioni disponibili globalmente per uso esterno
        window.getSelectedFeatures = getSelectedFeatures;
        window.meetsRequirements = meetsRequirements;

        function displayResults(data) {
            const resultsContent = document.getElementById('results-content');
            
            let caratteristicheWarning = '';
            if (data.tipologia === 'A' && data.caratteristicheA < 6) {
                caratteristicheWarning = `<div class="warning">⚠️ Per Tipologia A servono almeno 6 caratteristiche (selezionate: ${data.caratteristicheA})</div>`;
            }

            let surfaceWarning = '';
            if (data.warning) {
                surfaceWarning = `<div class="warning">⚠️ ${data.warning}</div>`;
            }

            let scontoMessage = '';
            if (data.scontoApplicato) {
                scontoMessage = `<div style="background: rgba(235, 235, 235, 0.8); padding: 10px; border-radius: 8px; margin: 10px 0; color: #2e7d32; font-weight: bold;">✅ Sconto 10% applicato al canone massimo</div>`;
            }

            // Calcolo tasse se disponibili i dati
            let taxSection = '';
            if (data.taxData) {
                const tx = data.taxData;
                const risparmioTasse = tx.tasseLibero - tx.tasseConcordato;
                
                taxSection = `
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid rgba(255,255,255,0.2);">
                        <h4 style="margin-bottom: 15px; text-align: center;">📊 CONFRONTO TASSE</h4>
                        
                        <div class="result-item">
                            <span>Valore catastale:</span>
                            <span class="result-value">€${data.valoreCatastale.toLocaleString()}</span>
                        </div>
                        
                        <h5 style="margin: 15px 0 10px 0; color: #4facfe;">🏠 CANONE CONCORDATO</h5>
                        <div class="result-item">
                            <span>Canone annuale:</span>
                            <span class="result-value">€${(tx.canoneAnnualeConcordato).toLocaleString()}</span>
                        </div>
                        <div class="result-item">
                            <span>Cedolare secca (10%):</span>
                            <span class="result-value">€${tx.cedolareConcordato.toLocaleString()}</span>
                        </div>
                        <div class="result-item">
                            <span>IMU:</span>
                            <span class="result-value">€${tx.imuConcordato.toLocaleString()}</span>
                        </div>
                        <div class="result-item" style="background: rgba(76, 175, 80, 0.2);">
                            <span><strong>Guadagno netto annuale:</strong></span>
                            <span class="result-value"><strong>€${tx.nettoConcordato.toLocaleString()}</strong></span>
                        </div>
                        
                        <h5 style="margin: 15px 0 10px 0; color: #ff6b6b;">📈 CANONE LIBERO (+${tx.incrementoCanone.toFixed(1)}%)</h5>
                        <div class="result-item">
                            <span>Canone annuale:</span>
                            <span class="result-value">€${tx.canoneAnnualeLibero.toLocaleString()}</span>
                        </div>
                        <div class="result-item">
                            <span>Cedolare secca (21%):</span>
                            <span class="result-value">€${tx.cedolareLibero.toLocaleString()}</span>
                        </div>
                        <div class="result-item">
                            <span>IMU (1,06%):</span>
                            <span class="result-value">€${tx.imuLibero.toLocaleString()}</span>
                        </div>
                        <div class="result-item" style="background: rgba(244, 67, 54, 0.2);">
                            <span><strong>Guadagno netto annuale:</strong></span>
                            <span class="result-value"><strong>€${tx.nettoLibero.toLocaleString()}</strong></span>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <div style="text-align: center; margin-bottom: 10px;"><strong>💡 ANALISI RISPARMIO</strong></div>
                            <div class="result-item" style="background: rgba(255,255,255,0.2);">
                                <span>Tasse canone concordato:</span>
                                <span class="result-value">€${tx.tasseConcordato.toLocaleString()}</span>
                            </div>
                            <div class="result-item" style="background: rgba(255,255,255,0.2);">
                                <span>Tasse canone libero:</span>
                                <span class="result-value">€${tx.tasseLibero.toLocaleString()}</span>
                            </div>
                            <div class="result-item" style="background: rgba(255,255,255,0.3); border: 2px solid white;">
                                <span><strong>Incremento tasse libero:</strong></span>
                                <span class="result-value"><strong>+${tx.incrementoTasse.toFixed(1)}%</strong></span>
                            </div>
                            <div class="result-item" style="background: rgba(255,255,255,0.3); border: 2px solid white;">
                                <span><strong>Risparmio tasse concordato:</strong></span>
                                <span class="result-value"><strong>€${risparmioTasse.toLocaleString()}</strong></span>
                            </div>
                        </div>
                    </div>
                `;
            }

            resultsContent.innerHTML = `
                <div class="result-item">
                    <span>Superficie convenzionale:</span>
                    <span class="result-value">${data.totalSurface.toFixed(2)} mq</span>
                </div>
                <div class="result-item">
                    <span>Canone base min:</span>
                    <span class="result-value">€${data.baseMinRent.toFixed(2)}</span>
                </div>
                <div class="result-item">
                    <span>Canone base max:</span>
                    <span class="result-value">€${data.baseMaxRent.toFixed(2)}</span>
                </div>
                <div class="result-item">
                    <span>Maggiorazioni totali:</span>
                    <span class="result-value">+${data.totalMaggiorazioni.toFixed(1)}%</span>
                </div>
                ${surfaceWarning}
                ${caratteristicheWarning}
                ${scontoMessage}
                <div class="final-result">
                    <div>💰 CANONE MENSILE</div>
                    <div class="price-range">€${data.finalMinRent.toFixed(2)} - €${data.finalMaxRent.toFixed(2)}</div>
                    <div style="font-size: 0.9em; opacity: 0.9;">Range di oscillazione applicabile</div>
                </div>
                ${taxSection}
            `;
        }

        // Mostra/nascondi campo canone personalizzato
        document.getElementById('confrontoCanone').addEventListener('change', function() {
            const customGroup = document.getElementById('customRentGroup');
            if (this.value === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
            
            // Ricalcola se ci sono già dati
            if (document.getElementById('quartiere').value && document.getElementById('tipologia').value) {
                setTimeout(calculateRent, 100);
            }
        });

        // Auto-calcolo quando vengono modificati i valori
        document.addEventListener('input', function(e) {
            if (e.target.type === 'number' && document.getElementById('quartiere').value && document.getElementById('tipologia').value) {
                setTimeout(calculateRent, 500);
            }
        });

        document.addEventListener('change', function(e) {
            if (e.target.type === 'select-one' || e.target.type === 'checkbox') {
                if (document.getElementById('quartiere').value && document.getElementById('tipologia').value) {
                    setTimeout(calculateRent, 100);
                }
            }
        });
    </script>
</body>
</html>
